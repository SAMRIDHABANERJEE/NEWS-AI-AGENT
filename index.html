<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NewsAI â€” Intelligent News Agent (OpenRouter)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Outfit:wght@300;400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet"/>
  <style>
    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESET & TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --ink:        #0a0a0f;
      --paper:      #0f0f18;
      --card:       #14141f;
      --card2:      #1a1a28;
      --rim:        rgba(255,255,255,0.07);
      --rim2:       rgba(255,255,255,0.12);
      --gold:       #f5c842;
      --gold-glow:  rgba(245,200,66,0.2);
      --gold-dim:   rgba(245,200,66,0.08);
      --sky:        #5dade2;
      --rose:       #e74c6e;
      --mint:       #48c9a9;
      --white:      #f2f0e8;
      --grey:       #7a7a8a;
      --dimgrey:    #3a3a4a;
      --serif:      'Instrument Serif', Georgia, serif;
      --sans:       'Outfit', sans-serif;
      --mono:       'Fira Code', monospace;
      --r:          12px;
      --rs:         7px;
    }

    html { height: 100%; }

    body {
      background: var(--ink);
      color: var(--white);
      font-family: var(--sans);
      font-size: 15px;
      line-height: 1.65;
      height: 100%;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ANIMATED AURORA BG
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .aurora {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      overflow: hidden;
    }

    .aurora-blob {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      opacity: 0.12;
      animation: drift 18s ease-in-out infinite alternate;
    }

    .aurora-blob:nth-child(1) { width: 600px; height: 600px; background: var(--gold); top: -200px; right: -100px; animation-duration: 20s; }
    .aurora-blob:nth-child(2) { width: 400px; height: 400px; background: var(--sky);  bottom: -100px; left: -100px; animation-duration: 15s; animation-delay: -5s; }
    .aurora-blob:nth-child(3) { width: 300px; height: 300px; background: var(--mint); top: 40%; left: 40%; animation-duration: 25s; animation-delay: -10s; opacity: 0.07; }

    @keyframes drift {
      0%   { transform: translate(0,0) scale(1); }
      50%  { transform: translate(40px,-30px) scale(1.05); }
      100% { transform: translate(-20px, 20px) scale(0.97); }
    }

    .grain {
      position: fixed;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      opacity: 0.022;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 512 512' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");
      background-size: 200px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LAYOUT SHELL
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .shell {
      position: relative;
      z-index: 2;
      display: grid;
      grid-template-columns: 280px 1fr;
      grid-template-rows: 100vh;
      height: 100vh;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       SIDEBAR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .sidebar {
      background: rgba(15,15,24,0.85);
      backdrop-filter: blur(24px);
      border-right: 1px solid var(--rim);
      display: flex;
      flex-direction: column;
      padding: 1.5rem 1.25rem;
      gap: 0.5rem;
      overflow-y: auto;
    }

    /* Logo */
    .brand {
      display: flex;
      align-items: center;
      gap: 0.7rem;
      padding: 0 0.25rem 1.5rem;
      border-bottom: 1px solid var(--rim);
      margin-bottom: 0.5rem;
    }

    .brand-icon {
      width: 36px; height: 36px;
      background: var(--gold);
      border-radius: var(--rs);
      display: flex; align-items: center; justify-content: center;
      font-size: 1.1rem;
      flex-shrink: 0;
      box-shadow: 0 0 20px var(--gold-glow);
    }

    .brand-name {
      font-family: var(--serif);
      font-size: 1.5rem;
      font-style: italic;
      letter-spacing: 0.01em;
      line-height: 1;
    }

    .brand-tag {
      font-family: var(--mono);
      font-size: 0.58rem;
      color: var(--grey);
      letter-spacing: 0.12em;
      margin-top: 1px;
    }

    /* API key setup box */
    .api-setup {
      background: var(--gold-dim);
      border: 1px solid rgba(245,200,66,0.18);
      border-radius: var(--r);
      padding: 1rem;
      margin-bottom: 0.5rem;
    }

    .api-setup-title {
      font-size: 0.78rem;
      font-weight: 600;
      color: var(--gold);
      margin-bottom: 0.35rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .api-input {
      width: 100%;
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--rim2);
      border-radius: var(--rs);
      padding: 0.5rem 0.7rem;
      color: var(--white);
      font-family: var(--mono);
      font-size: 0.75rem;
      outline: none;
      transition: border-color 0.2s;
      margin-top: 0.4rem;
    }

    .api-input:focus { border-color: rgba(245,200,66,0.4); }
    .api-input::placeholder { color: var(--dimgrey); }

    .save-key-btn {
      width: 100%;
      margin-top: 0.5rem;
      background: var(--gold);
      color: #000;
      border: none;
      border-radius: var(--rs);
      padding: 0.45rem;
      font-family: var(--sans);
      font-size: 0.78rem;
      font-weight: 600;
      cursor: pointer;
      transition: opacity 0.2s, transform 0.15s;
    }

    .save-key-btn:hover { opacity: 0.88; transform: translateY(-1px); }

    /* Section label */
    .sec-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.2em;
      color: var(--dimgrey);
      padding: 0.75rem 0.25rem 0.25rem;
    }

    /* Chip topics */
    .topic-chips {
      display: flex;
      flex-direction: column;
      gap: 3px;
    }

    .topic-chip {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.55rem 0.75rem;
      border-radius: var(--rs);
      border: none;
      background: transparent;
      color: var(--grey);
      font-family: var(--sans);
      font-size: 0.84rem;
      cursor: pointer;
      transition: all 0.18s;
      text-align: left;
      width: 100%;
    }

    .topic-chip:hover { background: var(--card2); color: var(--white); }
    .topic-chip.active { background: var(--gold-dim); color: var(--gold); border: 1px solid rgba(245,200,66,0.2); }
    .topic-chip .chip-icon { font-size: 1rem; width: 20px; text-align: center; flex-shrink: 0; }

    /* Status */
    .status-row {
      margin-top: auto;
      display: flex;
      align-items: center;
      gap: 0.6rem;
      padding: 0.85rem 0.75rem;
      background: var(--card);
      border: 1px solid var(--rim);
      border-radius: var(--r);
    }

    .status-dot {
      width: 8px; height: 8px;
      border-radius: 50%;
      background: var(--dimgrey);
      flex-shrink: 0;
      transition: background 0.4s, box-shadow 0.4s;
    }

    .status-dot.ready { background: var(--mint); box-shadow: 0 0 8px var(--mint); animation: blink 2s infinite; }
    .status-dot.busy  { background: var(--gold); box-shadow: 0 0 8px var(--gold-glow); animation: blink 0.6s infinite; }
    .status-dot.error { background: var(--rose); }

    @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

    .status-text  { font-size: 0.78rem; font-weight: 500; color: var(--white); }
    .status-model { font-family: var(--mono); font-size: 0.62rem; color: var(--grey); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN CHAT AREA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .main {
      display: flex;
      flex-direction: column;
      overflow: hidden;
      position: relative;
    }

    /* Top bar */
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 2rem;
      border-bottom: 1px solid var(--rim);
      background: rgba(10,10,15,0.6);
      backdrop-filter: blur(16px);
      flex-shrink: 0;
    }

    .topbar-left h1 {
      font-family: var(--serif);
      font-size: 1.35rem;
      font-style: italic;
      font-weight: 400;
      color: var(--white);
    }

    .topbar-left p {
      font-size: 0.75rem;
      color: var(--grey);
      margin-top: 1px;
    }

    .topbar-right { display: flex; gap: 0.5rem; align-items: center; }

    .tb-pill {
      font-family: var(--mono);
      font-size: 0.63rem;
      padding: 0.25rem 0.6rem;
      border: 1px solid var(--rim2);
      border-radius: 100px;
      color: var(--grey);
      letter-spacing: 0.04em;
    }

    .tb-pill.live {
      color: var(--mint);
      border-color: rgba(72,201,169,0.3);
      background: rgba(72,201,169,0.06);
      animation: blink 2.5s infinite;
    }

    .new-chat-btn {
      background: var(--card2);
      border: 1px solid var(--rim2);
      border-radius: var(--rs);
      color: var(--white);
      font-family: var(--sans);
      font-size: 0.78rem;
      font-weight: 500;
      padding: 0.38rem 0.8rem;
      cursor: pointer;
      display: flex; align-items: center; gap: 0.4rem;
      transition: all 0.18s;
    }

    .new-chat-btn:hover { background: var(--card); border-color: var(--gold); color: var(--gold); }

    /* Chat messages */
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      scroll-behavior: smooth;
    }

    .messages::-webkit-scrollbar { width: 4px; }
    .messages::-webkit-scrollbar-thumb { background: var(--dimgrey); border-radius: 2px; }

    /* Welcome screen */
    .welcome {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
      gap: 1.5rem;
      animation: fadeUp 0.6s ease both;
    }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(20px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .welcome-icon {
      font-size: 3rem;
      filter: drop-shadow(0 0 20px var(--gold-glow));
    }

    .welcome h2 {
      font-family: var(--serif);
      font-size: clamp(1.8rem, 4vw, 2.8rem);
      font-style: italic;
      font-weight: 400;
      line-height: 1.2;
    }

    .welcome h2 span { color: var(--gold); }

    .welcome p {
      color: var(--grey);
      font-size: 0.92rem;
      max-width: 42ch;
      line-height: 1.7;
    }

    .quick-prompts {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      max-width: 560px;
    }

    .qp-btn {
      background: var(--card);
      border: 1px solid var(--rim2);
      border-radius: 100px;
      color: var(--grey);
      font-family: var(--sans);
      font-size: 0.8rem;
      padding: 0.4rem 0.9rem;
      cursor: pointer;
      transition: all 0.2s;
      white-space: nowrap;
    }

    .qp-btn:hover {
      background: var(--gold-dim);
      border-color: rgba(245,200,66,0.3);
      color: var(--gold);
      transform: translateY(-1px);
    }

    /* Message rows */
    .msg-row {
      display: flex;
      gap: 0.9rem;
      animation: fadeUp 0.3s ease both;
    }

    .msg-row.user { flex-direction: row-reverse; }

    .msg-avatar {
      width: 34px; height: 34px;
      border-radius: 50%;
      flex-shrink: 0;
      display: flex; align-items: center; justify-content: center;
      font-size: 0.85rem;
      margin-top: 3px;
    }

    .msg-row.ai .msg-avatar {
      background: var(--gold);
      color: #000;
      box-shadow: 0 0 12px var(--gold-glow);
    }

    .msg-row.user .msg-avatar {
      background: var(--card2);
      border: 1px solid var(--rim2);
      color: var(--grey);
      font-size: 0.68rem;
      font-family: var(--mono);
      font-weight: 500;
    }

    .msg-body { max-width: 78%; display: flex; flex-direction: column; gap: 0.25rem; }
    .msg-row.user .msg-body { align-items: flex-end; }

    .msg-meta {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.72rem;
    }

    .msg-name { font-weight: 600; color: var(--grey); }
    .msg-row.ai .msg-name { color: var(--gold); }
    .msg-time { color: var(--dimgrey); font-family: var(--mono); font-size: 0.62rem; }

    .msg-bubble {
      background: var(--card);
      border: 1px solid var(--rim);
      border-radius: var(--r);
      padding: 0.9rem 1.1rem;
      font-size: 0.9rem;
      line-height: 1.75;
      color: var(--white);
    }

    .msg-row.ai .msg-bubble {
      border-top-left-radius: 2px;
      background: var(--card);
      border-color: rgba(245,200,66,0.1);
    }

    .msg-row.user .msg-bubble {
      border-top-right-radius: 2px;
      background: rgba(93,173,226,0.07);
      border-color: rgba(93,173,226,0.15);
    }

    .msg-bubble p   { margin-bottom: 0.6rem; }
    .msg-bubble p:last-child { margin-bottom: 0; }
    .msg-bubble strong { color: var(--gold); font-weight: 600; }
    .msg-bubble em { color: var(--sky); font-style: normal; }

    .msg-bubble h3 {
      font-family: var(--serif);
      font-style: italic;
      font-size: 1.05rem;
      color: var(--white);
      margin: 0.75rem 0 0.35rem;
      padding-bottom: 0.25rem;
      border-bottom: 1px solid var(--rim);
    }

    .msg-bubble ul, .msg-bubble ol {
      padding-left: 1.2rem;
      margin-bottom: 0.6rem;
    }

    .msg-bubble li { margin-bottom: 0.3rem; }

    .msg-bubble a {
      color: var(--sky);
      text-decoration: none;
      border-bottom: 1px solid rgba(93,173,226,0.3);
      transition: color 0.2s;
    }

    .msg-bubble a:hover { color: var(--white); }

    .msg-bubble code {
      font-family: var(--mono);
      font-size: 0.82em;
      background: rgba(255,255,255,0.06);
      padding: 0.1em 0.35em;
      border-radius: 4px;
      color: var(--mint);
    }

    .msg-bubble pre {
      background: rgba(0,0,0,0.3);
      border: 1px solid var(--rim);
      border-radius: var(--rs);
      padding: 0.85rem 1rem;
      overflow-x: auto;
      margin: 0.5rem 0;
    }

    .msg-bubble pre code { background: none; padding: 0; }

    /* News card grid inside bubble */
    .news-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
      gap: 0.75rem;
      margin-top: 0.75rem;
    }

    .news-card {
      background: rgba(0,0,0,0.25);
      border: 1px solid var(--rim2);
      border-radius: var(--rs);
      padding: 0.85rem;
      transition: border-color 0.2s, transform 0.2s;
    }

    .news-card:hover { border-color: rgba(245,200,66,0.3); transform: translateY(-2px); }

    .news-card-label {
      font-family: var(--mono);
      font-size: 0.6rem;
      letter-spacing: 0.12em;
      color: var(--gold);
      margin-bottom: 0.35rem;
    }

    .news-card h4 { font-size: 0.85rem; font-weight: 600; color: var(--white); line-height: 1.4; margin-bottom: 0.3rem; }
    .news-card p  { font-size: 0.78rem; color: var(--grey); line-height: 1.5; }

    /* Typing indicator */
    .typing-row { display: flex; gap: 0.9rem; }

    .typing-bubble {
      background: var(--card);
      border: 1px solid rgba(245,200,66,0.1);
      border-radius: var(--r);
      border-top-left-radius: 2px;
      padding: 0.85rem 1.1rem;
      display: flex; align-items: center; gap: 5px;
    }

    .dot { width: 7px; height: 7px; border-radius: 50%; background: var(--gold); animation: bounce 1.3s ease-in-out infinite; opacity: 0.7; }
    .dot:nth-child(2) { animation-delay: 0.2s; }
    .dot:nth-child(3) { animation-delay: 0.4s; }

    @keyframes bounce { 0%,60%,100%{transform:translateY(0);opacity:0.6} 30%{transform:translateY(-6px);opacity:1} }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INPUT AREA
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .input-section {
      padding: 1rem 2rem 1.5rem;
      border-top: 1px solid var(--rim);
      background: rgba(10,10,15,0.7);
      backdrop-filter: blur(16px);
      flex-shrink: 0;
    }

    .input-wrap {
      display: flex;
      align-items: flex-end;
      gap: 0.75rem;
      background: var(--card);
      border: 1px solid var(--rim2);
      border-radius: var(--r);
      padding: 0.75rem 0.75rem 0.75rem 1.1rem;
      transition: border-color 0.25s, box-shadow 0.25s;
    }

    .input-wrap:focus-within {
      border-color: rgba(245,200,66,0.35);
      box-shadow: 0 0 0 3px rgba(245,200,66,0.05), 0 8px 30px rgba(0,0,0,0.3);
    }

    #userInput {
      flex: 1;
      background: transparent;
      border: none;
      outline: none;
      color: var(--white);
      font-family: var(--sans);
      font-size: 0.93rem;
      line-height: 1.55;
      resize: none;
      max-height: 180px;
      overflow-y: auto;
    }

    #userInput::placeholder { color: var(--dimgrey); }

    .send-btn {
      width: 40px; height: 40px;
      background: var(--gold);
      border: none;
      border-radius: var(--rs);
      color: #000;
      cursor: pointer;
      display: flex; align-items: center; justify-content: center;
      flex-shrink: 0;
      transition: all 0.18s;
      box-shadow: 0 2px 12px rgba(245,200,66,0.25);
    }

    .send-btn:hover { transform: scale(1.06); box-shadow: 0 0 20px rgba(245,200,66,0.4); }
    .send-btn:active { transform: scale(0.95); }
    .send-btn:disabled { opacity: 0.35; cursor: not-allowed; transform: none; box-shadow: none; }
    .send-btn svg { width: 16px; height: 16px; }

    .input-footer {
      display: flex;
      justify-content: space-between;
      margin-top: 0.4rem;
      padding: 0 0.2rem;
      font-family: var(--mono);
      font-size: 0.62rem;
      color: var(--dimgrey);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       TOAST
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .toast {
      position: fixed;
      bottom: 2rem; left: 50%;
      transform: translateX(-50%) translateY(20px);
      z-index: 999;
      font-family: var(--mono);
      font-size: 0.75rem;
      padding: 0.55rem 1.1rem;
      border-radius: 100px;
      background: rgba(20,20,30,0.95);
      border: 1px solid var(--rim2);
      color: var(--white);
      backdrop-filter: blur(12px);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
    }

    .toast.show   { opacity: 1; transform: translateX(-50%) translateY(0); }
    .toast.ok     { color: var(--mint); border-color: rgba(72,201,169,0.3); }
    .toast.err    { color: var(--rose); border-color: rgba(231,76,110,0.3); }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media (max-width: 768px) {
      .shell { grid-template-columns: 1fr; }
      .sidebar { display: none; }
      .messages { padding: 1rem; }
      .input-section { padding: 0.75rem 1rem 1rem; }
      .topbar { padding: 0.75rem 1rem; }
      .msg-body { max-width: 88%; }
      .welcome h2 { font-size: 1.6rem; }
    }
  </style>
</head>
<body>
  <div class="aurora">
    <div class="aurora-blob"></div>
    <div class="aurora-blob"></div>
    <div class="aurora-blob"></div>
  </div>
  <div class="grain"></div>

  <div class="shell">
    <!-- â•â•â• SIDEBAR â•â•â• -->
    <aside class="sidebar">
      <div class="brand">
        <div class="brand-icon">ğŸ“°</div>
        <div>
          <div class="brand-name">NewsAI</div>
          <div class="brand-tag">INTELLIGENT AGENT</div>
        </div>
      </div>

      <!-- API Key -->
      <div class="api-setup">
        <div class="api-setup-title">ğŸ”‘ OpenRouter API Key</div>
        <div style="font-size:0.72rem;color:var(--grey);line-height:1.4">Get your free key at <a href="https://openrouter.ai/keys" target="_blank" style="color:var(--gold);text-decoration:none;">openrouter.ai/keys</a>. Stays in your browser only.</div>
        <input class="api-input" type="password" id="apiKeyInput" placeholder="sk-or-v1-â€¦"/>
        <button class="save-key-btn" id="saveKeyBtn">Save Key</button>
      </div>

      <!-- Quick Topics -->
      <div class="sec-label">QUICK TOPICS</div>
      <div class="topic-chips">
        <button class="topic-chip" data-prompt="Give me today's top 5 world news headlines with a brief summary of each.">
          <span class="chip-icon">ğŸŒ</span> World News
        </button>
        <button class="topic-chip" data-prompt="What are the latest technology and AI news stories? Give me the top 5.">
          <span class="chip-icon">ğŸ’»</span> Tech & AI
        </button>
        <button class="topic-chip" data-prompt="Summarise the most important business and markets news today.">
          <span class="chip-icon">ğŸ“ˆ</span> Business
        </button>
        <button class="topic-chip" data-prompt="What are the top sports news stories right now?">
          <span class="chip-icon">âš½</span> Sports
        </button>
        <button class="topic-chip" data-prompt="Tell me the latest science and space exploration news.">
          <span class="chip-icon">ğŸ”¬</span> Science
        </button>
        <button class="topic-chip" data-prompt="What are the top entertainment and pop culture stories today?">
          <span class="chip-icon">ğŸ¬</span> Entertainment
        </button>
        <button class="topic-chip" data-prompt="Give me a full daily briefing: top world, tech, business, and science stories in one summary.">
          <span class="chip-icon">â˜€ï¸</span> Daily Briefing
        </button>
      </div>

      <!-- Status -->
      <div class="status-row">
        <div class="status-dot" id="statusDot"></div>
        <div>
          <div class="status-text" id="statusText">No API key</div>
          <div class="status-model">openrouter Â· perplexity/sonar</div>
        </div>
      </div>
    </aside>

    <!-- â•â•â• MAIN â•â•â• -->
    <main class="main">
      <!-- Topbar -->
      <div class="topbar">
        <div class="topbar-left">
          <h1>News Intelligence Agent</h1>
          <p>Ask anything Â· Live web search Â· Daily briefings</p>
        </div>
        <div class="topbar-right">
          <div class="tb-pill live" id="liveBadge">â— LIVE SEARCH</div>
          <button class="new-chat-btn" id="newChatBtn">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            New Chat
          </button>
        </div>
      </div>

      <!-- Messages -->
      <div class="messages" id="messages">
        <!-- Welcome shown by JS -->
      </div>

      <!-- Input -->
      <div class="input-section">
        <div class="input-wrap">
          <textarea id="userInput" placeholder="Ask me anything â€” news, analysis, questionsâ€¦" rows="1"></textarea>
          <button class="send-btn" id="sendBtn" aria-label="Send">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
              <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
        <div class="input-footer">
          <span id="charCount">0 / 2000</span>
          <span>Enter to send Â· Shift+Enter for newline</span>
        </div>
      </div>
    </main>
  </div>

  <div class="toast" id="toast"></div>

  <script>
  /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     NewsAI â€” Core Application
     Direct calls to Anthropic API with web_search tool
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

  // â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let apiKey       = localStorage.getItem('newsai_or_key') || '';
  let conversation = []; // full message history for multi-turn
  let busy         = false;

  const SYSTEM_PROMPT = `You are NewsAI, an expert news intelligence agent with access to real-time web search.

Your personality: sharp, direct, knowledgeable â€” like a senior editor at a world-class news organisation.

Rules:
- For any news or current events query, search the web for the latest information. Never rely solely on training data for news.
- Structure news summaries clearly: use **bold** for key names/terms, and organised sections when covering multiple stories.
- When listing news stories, format each with a headline and 1-2 sentence summary.
- For general questions (not news), answer directly from knowledge.
- Keep responses focused and readable. No fluff.
- Today's date context: ${new Date().toLocaleDateString('en-US', {weekday:'long', year:'numeric', month:'long', day:'numeric'})}.`;

  // â”€â”€ DOM â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const messagesEl  = document.getElementById('messages');
  const userInput   = document.getElementById('userInput');
  const sendBtn     = document.getElementById('sendBtn');
  const statusDot   = document.getElementById('statusDot');
  const statusText  = document.getElementById('statusText');
  const apiKeyInput = document.getElementById('apiKeyInput');
  const saveKeyBtn  = document.getElementById('saveKeyBtn');
  const newChatBtn  = document.getElementById('newChatBtn');
  const charCount   = document.getElementById('charCount');
  const toast       = document.getElementById('toast');

  // â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Clear any old Anthropic key that may be saved from previous version
  if (localStorage.getItem('newsai_key')) {
    localStorage.removeItem('newsai_key');
  }

  if (apiKey) {
    apiKeyInput.value = apiKey.slice(0, 12) + 'â€¦';
    setStatus('ready', 'Ready');
  }

  showWelcome();

  // â”€â”€ API KEY â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  saveKeyBtn.addEventListener('click', () => {
    const val = apiKeyInput.value.trim();
    if (!val || val.length < 20) {
      showToast('Enter a valid OpenRouter key (sk-or-v1-â€¦)', 'err');
      return;
    }
    apiKey = val;
    localStorage.setItem('newsai_or_key', val);
    apiKeyInput.value = val.slice(0, 12) + 'â€¦';
    setStatus('ready', 'Ready');
    showToast('API key saved âœ“', 'ok');
  });

  // â”€â”€ TOPIC CHIPS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  document.querySelectorAll('.topic-chip').forEach(chip => {
    chip.addEventListener('click', () => {
      document.querySelectorAll('.topic-chip').forEach(c => c.classList.remove('active'));
      chip.classList.add('active');
      userInput.value = chip.dataset.prompt;
      userInput.dispatchEvent(new Event('input'));
      userInput.focus();
    });
  });

  // â”€â”€ TEXTAREA AUTO-RESIZE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  userInput.addEventListener('input', () => {
    userInput.style.height = 'auto';
    userInput.style.height = Math.min(userInput.scrollHeight, 180) + 'px';
    const l = userInput.value.length;
    charCount.textContent = `${l} / 2000`;
  });

  userInput.addEventListener('keydown', e => {
    if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); handleSend(); }
  });

  sendBtn.addEventListener('click', handleSend);

  newChatBtn.addEventListener('click', () => {
    conversation = [];
    messagesEl.innerHTML = '';
    showWelcome();
    document.querySelectorAll('.topic-chip').forEach(c => c.classList.remove('active'));
    showToast('New chat started', 'ok');
  });

  // â”€â”€ QUICK PROMPTS in welcome â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  messagesEl.addEventListener('click', e => {
    const btn = e.target.closest('.qp-btn');
    if (btn) {
      userInput.value = btn.dataset.prompt;
      userInput.dispatchEvent(new Event('input'));
      handleSend();
    }
  });

  // â”€â”€ SEND HANDLER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  async function handleSend() {
    const text = userInput.value.trim();
    if (!text || busy) return;

    if (!apiKey) {
      showToast('Please enter your OpenRouter API key in the sidebar', 'err');
      apiKeyInput.focus();
      return;
    }

    // Clear welcome if present
    const welcome = messagesEl.querySelector('.welcome');
    if (welcome) welcome.remove();

    // Render user message
    addUserMsg(text);
    conversation.push({ role: 'user', content: text });
    userInput.value = '';
    userInput.style.height = 'auto';
    charCount.textContent = '0 / 2000';
    document.querySelectorAll('.topic-chip').forEach(c => c.classList.remove('active'));

    busy = true;
    sendBtn.disabled = true;
    setStatus('busy', 'Thinkingâ€¦');

    const typingEl = addTyping();

    try {
      const reply = await callClaude(conversation);
      typingEl.remove();
      addAIMsg(reply);
      conversation.push({ role: 'assistant', content: reply });
      setStatus('ready', 'Ready');
    } catch (err) {
      typingEl.remove();
      addAIMsg(`**Error:** ${err.message}\n\nPlease check your API key and try again.`);
      setStatus('error', 'Error');
      console.error('[NewsAI]', err);
    } finally {
      busy = false;
      sendBtn.disabled = false;
      userInput.focus();
    }
  }

  // â”€â”€ OPENROUTER API CALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  // Uses perplexity/sonar â€” has built-in live web search, no tool loop needed
  async function callClaude(messages) {
    const res = await fetch('https://openrouter.ai/api/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`,
        'HTTP-Referer': window.location.href,
        'X-Title': 'NewsAI Agent',
      },
      body: JSON.stringify({
        model: 'perplexity/sonar',   // live web search built-in
        messages: [
          { role: 'system', content: SYSTEM_PROMPT },
          ...messages
        ],
        max_tokens: 4096,
        temperature: 0.7,
      }),
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err?.error?.message || `HTTP ${res.status}`);
    }

    const data = await res.json();
    return data.choices?.[0]?.message?.content || 'No response received.';
  }

  // â”€â”€ RENDER HELPERS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function addUserMsg(text) {
    const el = document.createElement('div');
    el.className = 'msg-row user';
    el.innerHTML = `
      <div class="msg-avatar">ME</div>
      <div class="msg-body">
        <div class="msg-meta">
          <span class="msg-name">You</span>
          <span class="msg-time">${nowTime()}</span>
        </div>
        <div class="msg-bubble">${escHtml(text).replace(/\n/g,'<br/>')}</div>
      </div>`;
    messagesEl.appendChild(el);
    scrollBottom();
  }

  function addAIMsg(markdown) {
    const el = document.createElement('div');
    el.className = 'msg-row ai';
    el.innerHTML = `
      <div class="msg-avatar">ğŸ“°</div>
      <div class="msg-body">
        <div class="msg-meta">
          <span class="msg-name">NewsAI</span>
          <span class="msg-time">${nowTime()}</span>
        </div>
        <div class="msg-bubble">${renderMarkdown(markdown)}</div>
      </div>`;
    messagesEl.appendChild(el);
    scrollBottom();
  }

  function addTyping() {
    const el = document.createElement('div');
    el.className = 'typing-row';
    el.innerHTML = `
      <div class="msg-avatar" style="background:var(--gold);color:#000;width:34px;height:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.85rem;flex-shrink:0;margin-top:3px;">ğŸ“°</div>
      <div class="typing-bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
    messagesEl.appendChild(el);
    scrollBottom();
    return el;
  }

  function showWelcome() {
    const el = document.createElement('div');
    el.className = 'welcome';
    el.innerHTML = `
      <div class="welcome-icon">ğŸ“°</div>
      <h2>Your <span>News Intelligence</span><br/>Agent is ready.</h2>
      <p>Ask me anything â€” breaking news, deep dives, daily briefings, analysis. I search the web in real time to give you the most current information.</p>
      <div class="quick-prompts">
        <button class="qp-btn" data-prompt="Give me today's top 5 world news headlines with brief summaries.">â˜€ï¸ Today's Briefing</button>
        <button class="qp-btn" data-prompt="What are the biggest tech and AI stories this week?">ğŸ’» Tech News</button>
        <button class="qp-btn" data-prompt="Summarise the latest business and stock market news.">ğŸ“ˆ Markets</button>
        <button class="qp-btn" data-prompt="What is happening in the world right now? Give me 5 breaking stories.">ğŸ”´ Breaking Now</button>
        <button class="qp-btn" data-prompt="What are the most important science discoveries or space news recently?">ğŸš€ Science & Space</button>
      </div>`;
    messagesEl.appendChild(el);
  }

  // â”€â”€ MARKDOWN RENDERER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function renderMarkdown(md) {
    return md
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      // Code blocks
      .replace(/```[\w]*\n?([\s\S]*?)```/g, '<pre><code>$1</code></pre>')
      // Inline code
      .replace(/`([^`]+)`/g, '<code>$1</code>')
      // H3
      .replace(/^### (.+)$/gm, '<h3>$1</h3>')
      // Bold
      .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
      // Italic (keep em as sky)
      .replace(/\*(.*?)\*/g, '<em>$1</em>')
      // Links
      .replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>')
      // Unordered lists
      .replace(/^\s*[-â€¢]\s+(.+)$/gm, '<li>$1</li>')
      .replace(/(<li>.*<\/li>)/s, m => `<ul>${m}</ul>`)
      // Numbered lists
      .replace(/^\d+\.\s+(.+)$/gm, '<li>$1</li>')
      // Line breaks â†’ paragraphs
      .split(/\n\n+/)
      .map(block => block.trim() ? (block.startsWith('<') ? block : `<p>${block.replace(/\n/g,'<br/>')}</p>`) : '')
      .join('');
  }

  // â”€â”€ STATUS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function setStatus(state, label) {
    statusDot.className = `status-dot ${state === 'ready' ? 'ready' : state === 'busy' ? 'busy' : state === 'error' ? 'error' : ''}`;
    statusText.textContent = label;
  }

  // â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  function scrollBottom() { messagesEl.scrollTop = messagesEl.scrollHeight; }
  function nowTime() { return new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'}); }
  function escHtml(t) { return t.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

  let toastTimer;
  function showToast(msg, type = '') {
    toast.textContent = msg;
    toast.className = `toast ${type}`;
    void toast.offsetWidth;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(() => toast.classList.remove('show'), 2800);
  }
  </script>
</body>
</html>
